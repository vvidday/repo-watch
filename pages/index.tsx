import type { NextPage } from 'next'
import Head from 'next/head'
import { useEffect, useState } from 'react'
import { supabase } from '../utils/supabaseClient'

const Home: NextPage = () => {
  // subscribe to inserts in event table

  const [update, setUpdate] = useState<any>(null)

  useEffect(() => {
    console.log('effect')
    const channel = supabase
      .channel('public:event')
      .on('postgres_changes', { event: 'INSERT', schema: 'public', table: 'event' }, (payload: any) => {
        console.log('change received', payload)
        setUpdate(payload)
      })
      .subscribe()
    return () => {
      supabase.removeAllChannels()
    }
  }, [])

  return (
    <div>
      <Head>
        <title>Repo Watch</title>
        <meta name="description" content="Generated by create next app" />
        <link rel="icon" href="/favicon.ico" />
      </Head>
      {JSON.stringify(update)}

      <main>Hello World</main>
    </div>
  )
}

export default Home
